<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>汉语词汇等级分析器（GitHub Pages）</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #333;
      line-height: 1.6;
    }
    .container{
      width: 100%;
      max-width: 900px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    header{
      background: linear-gradient(to right, #3498db, #2c3e50);
      color: #fff;
      padding: 30px 20px;
      text-align: center;
    }
    h1{ font-size: 2.25rem; margin-bottom: 10px; }
    .subtitle{ font-size: 1.05rem; opacity: .95; max-width: 760px; margin: 0 auto; }
    .main-content{
      padding: 30px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .input-section{
      background: #f8f9fa;
      border-radius: 10px;
      padding: 22px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .input-group{
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }
    input[type="text"]{
      flex: 1;
      padding: 15px;
      border: 2px solid #e1e5eb;
      border-radius: 8px;
      font-size: 1.05rem;
      transition: all .2s ease;
    }
    input[type="text"]:focus{
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
    }
    button{
      background: #3498db;
      color: #fff;
      border: none;
      padding: 0 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.0rem;
      font-weight: 650;
      transition: all .2s ease;
      white-space: nowrap;
    }
    button:hover{
      background: #2980b9;
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .levels-info{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .level-tag{
      padding: 8px 15px;
      border-radius: 999px;
      font-size: .9rem;
      font-weight: 650;
    }
    .beginner-tag{ background:#e8f5e9; color:#2e7d32; }
    .intermediate-tag{ background:#fff8e1; color:#ff8f00; }
    .advanced-tag{ background:#ffebee; color:#c62828; }

    #statusBar{
      margin-top: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      font-size:.95rem;
      color:#2c3e50;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:#eef3f8;
      border: 1px solid #dde6f0;
    }
    .dot{ width:10px; height:10px; border-radius:50%; background:#999; }
    .dot.ok{ background:#2ecc71; }
    .dot.warn{ background:#f1c40f; }
    .dot.bad{ background:#e74c3c; }

    .loader-row{
      margin-top: 12px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      align-items:center;
    }
    .file-btn{ background:#27ae60; }
    .file-btn:hover{ background:#1e8f4f; }
    .ghost-btn{
      background:#7f8c8d;
    }
    .ghost-btn:hover{ background:#667172; }

    .small{
      font-size:.9rem;
      color:#556;
      text-align:center;
      margin-top:8px;
    }

    #result{
      background:#fff;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      display:none;
      animation: fadeIn .45s ease;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(8px); }
      to{ opacity:1; transform: translateY(0); }
    }
    .word-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
      padding-bottom: 14px;
      border-bottom: 1px solid #eee;
      flex-wrap:wrap;
    }
    .word{
      font-size: 2.05rem;
      font-weight: 750;
      color:#2c3e50;
    }
    .level-badge{
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 750;
    }
    .beginner{ background:#4caf50; color:#fff; }
    .intermediate{ background:#ffc107; color:#333; }
    .advanced{ background:#f44336; color:#fff; }

    .meaning{
      font-size: 1.05rem;
      margin-bottom: 10px;
      line-height: 1.8;
    }
    .kv{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap: 8px 12px;
      margin-top: 12px;
    }
    .k{ color:#60748a; font-weight:650; }
    .v{ color:#2c3e50; word-break: break-word; }

    .example{
      background:#f8f9fa;
      padding: 14px;
      border-radius: 8px;
      border-left: 4px solid #3498db;
      margin-top: 14px;
      font-style: italic;
    }
    .example strong{ color:#3498db; font-style: normal; }

    .unknown-result h3{ margin-bottom:8px; color:#2c3e50; }
    .unknown-result p{ color:#556; }

    .suggestions h3{ margin-bottom: 12px; color:#2c3e50; }
    .suggested-words{ display:flex; flex-wrap:wrap; gap:10px; }
    .word-chip{
      padding: 8px 15px;
      background:#e1f5fe;
      border-radius: 999px;
      cursor:pointer;
      transition: all .15s ease;
      user-select:none;
    }
    .word-chip:hover{
      background:#b3e5fc;
      transform: translateY(-1px);
    }

    footer{
      text-align:center;
      padding: 20px;
      background:#2c3e50;
      color:#ecf0f1;
      font-size: .9rem;
    }

    code.inline{ background:#f0f3f6; padding:2px 6px; border-radius:6px; }

    @media (max-width:768px){
      .input-group{ flex-direction:column; }
      button{ width:100%; padding: 14px; }
      .kv{ grid-template-columns: 90px 1fr; }
    }
    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>汉语词汇等级分析器</h1>
      <p class="subtitle">
        GitHub Pages 上会自动读取同目录 <b>词汇2022.json</b>；若读取失败，可手动选择 JSON 文件作为兜底。
      </p>
    </header>

    <div class="main-content">
      <div class="input-section">
        <div class="input-group">
          <input type="text" id="wordInput" placeholder="输入汉语词语（如：爱、阿姨、改革开放）" />
          <button onclick="analyzeWord()">分析词汇</button>
        </div>

        <div class="levels-info">
          <div class="level-tag beginner-tag">初级（一级–三级）</div>
          <div class="level-tag intermediate-tag">中级（四级–五级）</div>
          <div class="level-tag advanced-tag">高级（六级–高等）</div>
        </div>

        <div id="statusBar">
          <div class="pill">
            <span class="dot warn" id="dbDot"></span>
            <span id="dbStatusText">正在初始化…</span>
          </div>
          <div class="pill">
            <span>词条数：<b id="dbCount">-</b></span>
          </div>
          <div class="pill">
            <span>路径：<b id="pathText">./词汇2022.json</b></span>
          </div>
        </div>

        <div class="loader-row">
          <button class="file-btn" id="pickBtn" type="button">选择词汇2022.json（兜底）</button>
          <button class="ghost-btn" id="retryBtn" type="button">重新自动读取</button>
          <input class="hidden" id="fileInput" type="file" accept=".json,application/json" />
        </div>

        <div class="small" id="hintText"></div>
      </div>

      <div id="result"></div>

      <div class="suggestions">
        <h3>试试这些词语：</h3>
        <div class="suggested-words" id="suggestedWords">
          <div class="word-chip" onclick="setWord('爱')">爱</div>
          <div class="word-chip" onclick="setWord('阿姨')">阿姨</div>
          <div class="word-chip" onclick="setWord('安静')">安静</div>
          <div class="word-chip" onclick="setWord('改革开放')">改革开放</div>
        </div>
      </div>
    </div>

    <footer>
      <p>汉语词汇等级分析器 &copy; 2026 | GitHub Pages 自动加载 + 手动选择兜底</p>
    </footer>
  </div>

  <script>
    /***********************
     * 配置：如果你把 json 放在别的目录，只改这一行
     ***********************/
    const DB_URL = "./词汇2022.json"; // 同目录部署（推荐） :contentReference[oaicite:1]{index=1}

    let rawList = [];
    let indexByWord = new Map();
    let userAdded = new Map();

    function normalizeWord(s){ return (s || "").trim(); }
    function escapeHtml(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#39;");
    }
    function escapeHtmlAttr(s){ return escapeHtml(s).replace(/"/g,"&quot;"); }

    function setDbStatus(type, text){
      const dot = document.getElementById("dbDot");
      dot.classList.remove("ok","warn","bad");
      dot.classList.add(type);
      document.getElementById("dbStatusText").textContent = text;
    }

    function buildIndex(list){
      const m = new Map();
      for(const row of list){
        const w = normalizeWord(row["词语"]);
        if(!w) continue;
        if(!m.has(w)) m.set(w, []);
        m.get(w).push(row);
      }
      return m;
    }

    function mergeEntries(word){
      const a = indexByWord.get(word) || [];
      const b = userAdded.get(word) || [];
      return [...a, ...b];
    }

    function getLevelGroup(levelText){
      if(!levelText) return { group:"未知", className:"intermediate", label:"未知" };
      const t = levelText.trim();
      const beginner = new Set(["一级","二级","三级"]);
      const mid = new Set(["四级","五级"]);
      const adv = new Set(["六级","高等"]);
      if(beginner.has(t)) return { group:"初级", className:"beginner", label:"一级–三级" };
      if(mid.has(t)) return { group:"中级", className:"intermediate", label:"四级–五级" };
      if(adv.has(t)) return { group:"高级", className:"advanced", label:"六级–高等" };
      return { group:"未知", className:"intermediate", label:t };
    }

    function refreshSuggestions(){
      const box = document.getElementById("suggestedWords");
      if(!rawList.length) return;

      const uniq = Array.from(new Set(
        rawList.map(r => normalizeWord(r["词语"])).filter(Boolean)
      ));
      const chosen = [];
      const n = Math.min(10, uniq.length);
      for(let i=0;i<n;i++){
        const idx = Math.floor(Math.random()*uniq.length);
        chosen.push(uniq.splice(idx,1)[0]);
      }
      box.innerHTML = chosen.map(w =>
        `<div class="word-chip" onclick="setWord('${escapeHtmlAttr(w)}')">${escapeHtml(w)}</div>`
      ).join("");
    }

    function validateVocabularyJson(data){
      if(!Array.isArray(data)){
        throw new Error("JSON 顶层必须是数组（Array）");
      }
      return true;
    }

    function applyVocabulary(data, sourceLabel){
      validateVocabularyJson(data);
      rawList = data;
      indexByWord = buildIndex(rawList);

      document.getElementById("dbCount").textContent = String(rawList.length);
      refreshSuggestions();

      setDbStatus("ok", `词库加载成功（${sourceLabel}）`);
      document.getElementById("hintText").textContent = "";
    }

    async function loadByFetch(){
      document.getElementById("pathText").textContent = DB_URL;
      if(location.protocol === "file:"){
        setDbStatus("bad", "检测到 file://：自动读取被浏览器限制。请用“选择 JSON”按钮。");
        document.getElementById("hintText").innerHTML =
          `你在本地双击打开（<code class="inline">file://</code>）。浏览器禁止 fetch 本地文件。请点击上方 <b>选择词汇2022.json（兜底）</b>。`;
        return false;
      }

      setDbStatus("warn", "正在自动读取同目录 JSON…");
      try{
        const resp = await fetch(DB_URL, { cache:"no-store" });
        if(!resp.ok) throw new Error("HTTP " + resp.status);
        const data = await resp.json();
        applyVocabulary(data, "自动读取（fetch）");
        return true;
      }catch(e){
        console.warn(e);
        setDbStatus("bad", "自动读取失败：请检查 GitHub Pages 部署路径/文件名，或用“选择 JSON”兜底。");
        document.getElementById("hintText").innerHTML =
          `自动读取失败（常见原因）：<br>
           1）仓库里没有放 <code class="inline">词汇2022.json</code> 或不在同目录；<br>
           2）文件名大小写/空格不一致；<br>
           3）GitHub Pages 指向的分支/目录不是你放文件的目录。<br>
           你可以先点击 <b>选择词汇2022.json（兜底）</b> 验证页面功能。`;
        return false;
      }
    }

    function pickLocalJsonFile(){
      document.getElementById("fileInput").click();
    }

    function loadFromFile(file){
      if(!file){
        setDbStatus("bad", "未选择文件");
        return;
      }
      if(!file.name.toLowerCase().endsWith(".json")){
        setDbStatus("bad", "请选择 .json 文件");
        return;
      }
      setDbStatus("warn", `正在读取本地：${file.name} …`);

      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          applyVocabulary(data, `本地选择/${file.name}`);
        }catch(err){
          console.error(err);
          setDbStatus("bad", "解析失败：请确认 JSON 是合法数组格式（UTF-8，合法 JSON）。");
        }
      };
      reader.onerror = () => setDbStatus("bad", "读取失败：FileReader 出错");
      reader.readAsText(file, "utf-8");
    }

    function setWord(word){
      document.getElementById("wordInput").value = word;
      analyzeWord();
    }

    function analyzeWord(){
      const word = normalizeWord(document.getElementById("wordInput").value);
      const resultDiv = document.getElementById("result");

      if(!rawList.length){
        resultDiv.innerHTML = `<div class="unknown-result"><h3>请先加载词库</h3><p>GitHub Pages 会自动读取同目录 JSON；若失败请点击“选择词汇2022.json（兜底）”。</p></div>`;
        resultDiv.style.display = "block";
        return;
      }
      if(!word){
        resultDiv.innerHTML = `<div class="unknown-result"><h3>请输入要分析的词语</h3><p>例如：爱 / 阿姨 / 改革开放</p></div>`;
        resultDiv.style.display = "block";
        return;
      }

      const entries = mergeEntries(word);

      if(entries.length){
        const order = { "一级":1,"二级":2,"三级":3,"四级":4,"五级":5,"六级":6,"高等":7 };
        entries.sort((a,b) => (order[a["级别"]]||99) - (order[b["级别"]]||99));

        const primary = entries[0];
        const lv = getLevelGroup(primary["级别"]);
        const pinyin = primary["拼音"] ? primary["拼音"] : "（缺）";
        const pos = primary["词性"] ? primary["词性"] : "（缺）";

        const variants = entries.map((it, idx) => {
          const lvl = it["级别"] || "（缺）";
          const py = it["拼音"] || "（缺）";
          const ps = it["词性"] || "（缺）";
          return `
            <div class="example">
              <strong>条目 ${idx+1}</strong><br/>
              <span>级别：${escapeHtml(lvl)} ｜ 拼音：${escapeHtml(py)} ｜ 词性：${escapeHtml(ps)}</span>
            </div>
          `;
        }).join("");

        resultDiv.innerHTML = `
          <div class="word-header">
            <div class="word">${escapeHtml(word)}</div>
            <div class="level-badge ${lv.className}">${lv.group}（${escapeHtml(primary["级别"] || "未知")}）</div>
          </div>

          <div class="meaning">
            <strong>等级判定：</strong>
            ${escapeHtml(primary["级别"] || "未知")}（归类：${lv.group}｜区间：${lv.label}）
          </div>

          <div class="kv">
            <div class="k">拼音</div><div class="v">${escapeHtml(pinyin)}</div>
            <div class="k">词性</div><div class="v">${escapeHtml(pos)}</div>
            <div class="k">同形条目</div><div class="v">${entries.length} 条（若存在不同拼音/词性/级别，将分别列出）</div>
          </div>

          ${variants}
        `;
      }else{
        resultDiv.innerHTML = `
          <div class="unknown-result">
            <h3>未找到词语 “${escapeHtml(word)}”</h3>
            <p>该词语不在当前词库中（或输入含空格/符号）。请尝试更精确的词语形式。</p>
          </div>
        `;
      }

      resultDiv.style.display = "block";
      resultDiv.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    document.getElementById("wordInput").addEventListener("keypress", (e) => {
      if(e.key === "Enter") analyzeWord();
    });

    document.getElementById("pickBtn").addEventListener("click", pickLocalJsonFile);
    document.getElementById("fileInput").addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      loadFromFile(file);
      e.target.value = "";
    });

    document.getElementById("retryBtn").addEventListener("click", loadByFetch);

    window.addEventListener("load", async () => {
      setDbStatus("warn", "正在自动读取词库…");
      await loadByFetch();
      document.getElementById("wordInput").focus();
    });
  </script>
</body>
</html>
