<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è´ªåƒè›‡è¯è¯­æŒ‘æˆ˜</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            background-image: url('https://img.freepik.com/free-vector/hand-painted-watercolor-pastel-sky-background_23-2148902771.jpg');
            background-size: cover;
            touch-action: none;
        }
        
        #header {
            display: flex;
            justify-content: space-between;
            padding: 15px 25px;
            background-color: #4a90e2;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 2;
            flex-shrink: 0;
        }
        
        #game-container {
            position: relative;
            flex-grow: 1;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            overflow: hidden;
        }
        
        #game-area {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #controls {
            display: flex;
            justify-content: center;
            padding: 15px;
            background-color: #4a90e2;
            gap: 15px;
            flex-shrink: 0;
            z-index: 2;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            background-color: #ff6b6b;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            min-width: 120px;
        }
        
        button:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
        }
        
        #music-btn {
            background-color: #66bb6a;
        }
        
        #music-btn:hover {
            background-color: #4caf50;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        
        .modal-content {
            background-color: #4a90e2;
            padding: 40px;
            border-radius: 20px;
            max-width: 90%;
            width: 500px;
            animation: bounce 0.5s;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-30px);}
            60% {transform: translateY(-15px);}
        }
        
        h1 {
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-top: 0;
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .modal p {
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 3s linear forwards;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .snake-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: absolute;
            transition: transform 0.1s ease;
        }
        
        .snake-head {
            background-color: #2196F3;
            z-index: 5;
            font-size: 24px;
        }
        
        .snake-body {
            background-color: #4CAF50;
            z-index: 4;
        }
        
        .food-item {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            position: absolute;
            padding: 10px;
            word-break: break-all;
            transition: all 0.2s;
            background-color: #FF9800;
            color: white;
            border: 3px solid #F57C00;
        }
        
        #start-control-btn {
            background-color: #4a90e2;
            margin-top: 0;
        }
        
        #start-control-btn:hover {
            background-color: #3a7bc8;
        }
        
        #mobile-controls {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 0;
            width: 100%;
            padding: 20px;
            z-index: 1;
        }
        
        .control-row {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .control-btn {
            width: 80px;
            height: 80px;
            background-color: rgba(74, 144, 226, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 15px;
            color: white;
            font-size: 32px;
            touch-action: manipulation;
        }
        
        .eat-effect {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: gold;
            border-radius: 50%;
            pointer-events: none;
            animation: eatPulse 0.5s forwards;
            z-index: 10;
        }
        
        @keyframes eatPulse {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        #lose-reason {
            color: #ffeb3b;
            font-weight: bold;
            margin: 15px 0;
            font-size: 20px;
        }
        
        @media (max-width: 768px) {
            #header {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            #mobile-controls {
                display: block;
                bottom: 90px;
            }
            
            button {
                padding: 12px 24px;
                font-size: 16px;
                min-width: 100px;
            }
            
            .modal-content {
                width: 90%;
                padding: 30px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .modal p {
                font-size: 18px;
            }
            
            .control-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
                margin: 0 10px;
            }
            
            .snake-segment {
                font-size: 18px;
                border-radius: 8px;
            }
            
            .snake-head {
                font-size: 22px;
            }
            
            .food-item {
                font-size: 20px;
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <div>å¾—åˆ†: <span id="score">0</span></div>
        <div>å…³å¡: <span id="level">1</span> (æ°´æœ)</div>
        <div>ç›®æ ‡: <span id="target">5</span>åˆ†</div>
    </div>
    
    <div id="game-container">
        <div id="game-area"></div>
        
        <div id="mobile-controls">
            <div class="control-row">
                <div class="control-btn" id="up-btn">â†‘</div>
            </div>
            <div class="control-row">
                <div class="control-btn" id="left-btn">â†</div>
                <div class="control-btn" id="down-btn">â†“</div>
                <div class="control-btn" id="right-btn">â†’</div>
            </div>
        </div>
        
        <div id="start-modal" class="modal" style="display: flex;">
            <div class="modal-content">
                <h1>è´ªåƒè›‡è¯è¯­æŒ‘æˆ˜</h1>
                <p>æ§åˆ¶è´ªåƒè›‡åƒæ‰æ­£ç¡®çš„è¯è¯­ï¼Œé¿å¼€é”™è¯¯çš„è¯è¯­ï¼</p>
                <p>ç¬¬ä¸€å…³ï¼šæ°´æœ (é¦™è•‰ã€è‹¹æœã€è¥¿ç“œ...)</p>
                <p style="color: #ffeb3b; font-weight: bold;">é«˜éš¾åº¦æ¨¡å¼ï¼šæ‰€æœ‰è¯è¯­é¢œè‰²ç›¸åŒï¼Œè¯·ä»”ç»†è¾¨è®¤ï¼</p>
                <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>
        
        <div id="win-modal" class="modal">
            <div class="modal-content">
                <h1>æ­å–œè¿‡å…³ï¼</h1>
                <p>ä½ æˆåŠŸå®Œæˆäº†è¿™ä¸€å…³ï¼</p>
                <button id="next-level-btn">è¿›å…¥ä¸‹ä¸€å…³</button>
            </div>
        </div>
        
        <div id="lose-modal" class="modal">
            <div class="modal-content">
                <h1>æ¸¸æˆç»“æŸ</h1>
                <p>ä¸è¦æ°”é¦ï¼Œå†è¯•ä¸€æ¬¡å§ï¼</p>
                <p id="lose-reason"></p>
                <button id="restart-btn">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>
    
    <div id="controls">
        <button id="start-control-btn">ç‚¹å‡»å¼€å§‹æ§åˆ¶</button>
        <button id="restart-game-btn">é‡æ¥</button>
        <button id="music-btn">å…³é—­éŸ³ä¹</button>
    </div>
    
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="eat-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
    </audio>
    <audio id="lose-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
    </audio>
    <audio id="win-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // æ¸¸æˆé…ç½®
        const config = {
            gridSize: 50, // æ›´å¤§çš„ç½‘æ ¼å°ºå¯¸
            initialSpeed: 350, // æ›´æ…¢çš„åˆå§‹é€Ÿåº¦
            speedIncrease: 3, // æ›´å°çš„é€Ÿåº¦å¢é‡
            minDistance: 5, // è¯è¯­é—´æœ€å°è·ç¦»
            mobileGridSize: 40 // ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç½‘æ ¼å°ºå¯¸
        };
        
        // æ¸¸æˆæ•°æ®
        const gameData = {
            snake: [],
            direction: 'right',
            nextDirection: 'right',
            foodItems: [],
            score: 0,
            level: 1,
            targetScore: 5,
            speed: config.initialSpeed,
            gameInterval: null,
            isPaused: false,
            isGameOver: false,
            musicOn: true,
            gameStarted: false,
            canControl: false,
            gridSize: window.innerWidth <= 768 ? config.mobileGridSize : config.gridSize,
            gameWidth: 0,
            gameHeight: 0,
            lastLoseReason: ""
        };
        
        // è¯è¯­åº“
        const wordCategories = [
            { // ç¬¬ä¸€å…³: æ°´æœ
                name: "æ°´æœ",
                correct: ["è‹¹æœ", "é¦™è•‰", "è¥¿ç“œ", "æ©™å­", "è‰è“", "è‘¡è„", "æ¡ƒå­", "æ¢¨å­", "èŠ’æœ", "è è"],
                wrong: ["çŸ³å¤´", "æ¡Œå­", "æ¿å‡³", "ä¹¦æœ¬", "é“…ç¬”", "ç”µè§†", "æ‰‹æœº", "é—¨", "çª—æˆ·", "åœ°æ¿"]
            },
            { // ç¬¬äºŒå…³: äº¤é€šå·¥å…·
                name: "äº¤é€šå·¥å…·",
                correct: ["æ±½è½¦", "è‡ªè¡Œè½¦", "å…¬äº¤è½¦", "é£æœº", "ç«è½¦", "è½®èˆ¹", "æ‘©æ‰˜è½¦", "å‡ºç§Ÿè½¦", "åœ°é“", "ç”µåŠ¨è½¦"],
                wrong: ["å†°ç®±", "æ´—è¡£æœº", "å¾®æ³¢ç‚‰", "å°ç¯", "æ²™å‘", "åºŠ", "è¡£æŸœ", "ä¹¦æ¶", "æ¤…å­", "èŒ¶å‡ "]
            },
            { // ç¬¬ä¸‰å…³: å®¶å…·
                name: "å®¶å…·",
                correct: ["æ²™å‘", "åºŠ", "æ¡Œå­", "æ¤…å­", "è¡£æŸœ", "ä¹¦æ¶", "èŒ¶å‡ ", "ç”µè§†æŸœ", "é‹æŸœ", "é¤æ¡Œ"],
                wrong: ["å°ç‹—", "å°çŒ«", "å°é¸Ÿ", "é‡‘é±¼", "å…”å­", "ä»“é¼ ", "ä¹Œé¾Ÿ", "é¹¦é¹‰", "æ¾é¼ ", "è´è¶"]
            }
        ];
        
        // DOMå…ƒç´ 
        const elements = {
            gameArea: document.getElementById('game-area'),
            scoreDisplay: document.getElementById('score'),
            levelDisplay: document.getElementById('level'),
            targetDisplay: document.getElementById('target'),
            startModal: document.getElementById('start-modal'),
            winModal: document.getElementById('win-modal'),
            loseModal: document.getElementById('lose-modal'),
            startBtn: document.getElementById('start-btn'),
            nextLevelBtn: document.getElementById('next-level-btn'),
            restartBtn: document.getElementById('restart-btn'),
            restartGameBtn: document.getElementById('restart-game-btn'),
            musicBtn: document.getElementById('music-btn'),
            startControlBtn: document.getElementById('start-control-btn'),
            bgMusic: document.getElementById('bg-music'),
            eatSound: document.getElementById('eat-sound'),
            loseSound: document.getElementById('lose-sound'),
            winSound: document.getElementById('win-sound'),
            upBtn: document.getElementById('up-btn'),
            downBtn: document.getElementById('down-btn'),
            leftBtn: document.getElementById('left-btn'),
            rightBtn: document.getElementById('right-btn'),
            loseReason: document.getElementById('lose-reason')
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // è®¡ç®—æ¸¸æˆåŒºåŸŸå¤§å°
            calculateGameSize();
            
            // é‡ç½®æ¸¸æˆæ•°æ®
            const centerX = Math.floor(gameData.gameWidth / 2);
            const centerY = Math.floor(gameData.gameHeight / 2);
            
            gameData.snake = [
                {x: centerX, y: centerY, word: "å¤´"},
                {x: centerX - 1, y: centerY, word: "èº«"},
                {x: centerX - 2, y: centerY, word: "å°¾"}
            ];
            
            gameData.direction = 'right';
            gameData.nextDirection = 'right';
            gameData.foodItems = [];
            gameData.score = 0;
            gameData.targetScore = 5;
            gameData.speed = config.initialSpeed;
            gameData.isGameOver = false;
            gameData.gameStarted = false;
            gameData.canControl = false;
            gameData.lastLoseReason = "";
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            
            // ç”Ÿæˆé£Ÿç‰©
            generateFood();
            
            // æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
            elements.gameArea.innerHTML = '';
            
            // ç»˜åˆ¶è›‡å’Œé£Ÿç‰©
            drawSnake();
            drawFood();
            
            // éšè—æ‰€æœ‰æ¨¡æ€æ¡†
            hideAllModals();
            
            // æ›´æ–°å¼€å§‹æ§åˆ¶æŒ‰é’®çŠ¶æ€
            elements.startControlBtn.textContent = "ç‚¹å‡»å¼€å§‹æ§åˆ¶";
            elements.startControlBtn.disabled = false;
        }
        
        // è®¡ç®—æ¸¸æˆåŒºåŸŸå¤§å°
        function calculateGameSize() {
            const headerHeight = document.getElementById('header').offsetHeight;
            const controlsHeight = document.getElementById('controls').offsetHeight;
            const availableHeight = window.innerHeight - headerHeight - controlsHeight;
            
            gameData.gridSize = window.innerWidth <= 768 ? config.mobileGridSize : config.gridSize;
            gameData.gameWidth = Math.floor(window.innerWidth / gameData.gridSize);
            gameData.gameHeight = Math.floor(availableHeight / gameData.gridSize);
            
            // ç¡®ä¿æœ€å°æ¸¸æˆåŒºåŸŸ
            if (gameData.gameWidth < 10) gameData.gameWidth = 10;
            if (gameData.gameHeight < 10) gameData.gameHeight = 10;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            initGame();
            hideAllModals();
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            if (gameData.gameInterval) {
                clearInterval(gameData.gameInterval);
            }
            
            gameData.gameInterval = setInterval(gameLoop, gameData.speed);
            gameData.gameStarted = true;
            
            // æ›´æ–°å¼€å§‹æ§åˆ¶æŒ‰é’®çŠ¶æ€
            elements.startControlBtn.textContent = "ç‚¹å‡»å¼€å§‹æ§åˆ¶";
            elements.startControlBtn.disabled = false;
        }
        
        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (gameData.isPaused || gameData.isGameOver || !gameData.canControl) return;
            
            // æ›´æ–°è›‡çš„ä½ç½®
            moveSnake();
            
            // æ£€æŸ¥ç¢°æ’
            checkCollisions();
            
            // é‡æ–°ç»˜åˆ¶
            elements.gameArea.innerHTML = '';
            drawSnake();
            drawFood();
        }
        
        // ç§»åŠ¨è›‡
        function moveSnake() {
            // æ›´æ–°æ–¹å‘
            gameData.direction = gameData.nextDirection;
            
            // è·å–è›‡å¤´
            const head = {...gameData.snake[0]};
            
            // æ ¹æ®æ–¹å‘ç§»åŠ¨è›‡å¤´
            switch (gameData.direction) {
                case 'up':
                    head.y -= 1;
                    break;
                case 'down':
                    head.y += 1;
                    break;
                case 'left':
                    head.x -= 1;
                    break;
                case 'right':
                    head.x += 1;
                    break;
            }
            
            // æ·»åŠ æ–°çš„è›‡å¤´
            gameData.snake.unshift(head);
            
            // ç§»é™¤è›‡å°¾
            gameData.snake.pop();
        }
        
        // æ£€æŸ¥ç¢°æ’
        function checkCollisions() {
            const head = gameData.snake[0];
            
            // æ£€æŸ¥å¢™å£ç¢°æ’
            if (head.x < 0 || head.x >= gameData.gameWidth || 
                head.y < 0 || head.y >= gameData.gameHeight) {
                gameData.lastLoseReason = "æ’å¢™äº†ï¼";
                gameOver();
                return;
            }
            
            // æ£€æŸ¥è‡ªèº«ç¢°æ’
            for (let i = 1; i < gameData.snake.length; i++) {
                if (head.x === gameData.snake[i].x && head.y === gameData.snake[i].y) {
                    gameData.lastLoseReason = "æ’åˆ°è‡ªå·±äº†ï¼";
                    gameOver();
                    return;
                }
            }
            
            // æ£€æŸ¥é£Ÿç‰©ç¢°æ’
            for (let i = 0; i < gameData.foodItems.length; i++) {
                const food = gameData.foodItems[i];
                if (head.x === food.x && head.y === food.y) {
                    const currentCategory = wordCategories[gameData.level - 1];
                    
                    if (food.isCorrect) {
                        // åƒåˆ°æ­£ç¡®é£Ÿç‰©
                        createEatEffect(food.x, food.y);
                        eatFood(i);
                        elements.eatSound.currentTime = 0;
                        elements.eatSound.play();
                    } else {
                        // åƒåˆ°é”™è¯¯é£Ÿç‰©
                        gameData.lastLoseReason = `åƒé”™äº†ï¼"${food.word}"ä¸æ˜¯${currentCategory.name}`;
                        gameOver();
                        elements.loseSound.play();
                    }
                    return;
                }
            }
        }
        
        // åˆ›å»ºåƒè¯ç‰¹æ•ˆ
        function createEatEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'eat-effect';
            effect.style.left = `${x * gameData.gridSize + gameData.gridSize/2 - 20}px`;
            effect.style.top = `${y * gameData.gridSize + gameData.gridSize/2 - 20}px`;
            elements.gameArea.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 500);
        }
        
        // åƒé£Ÿç‰©
        function eatFood(index) {
            // å¢åŠ åˆ†æ•°
            gameData.score++;
            updateDisplay();
            
            // ç§»é™¤è¢«åƒçš„é£Ÿç‰©
            const eatenFood = gameData.foodItems.splice(index, 1)[0];
            
            // å¢åŠ è›‡çš„é•¿åº¦
            const tail = {...gameData.snake[gameData.snake.length - 1]};
            tail.word = eatenFood.word; // è›‡èº«æ˜¾ç¤ºåƒåˆ°çš„è¯
            gameData.snake.push(tail);
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡åˆ†æ•°
            if (gameData.score >= gameData.targetScore) {
                levelComplete();
                return;
            }
            
            // å¦‚æœé£Ÿç‰©å¤ªå°‘ï¼Œç”Ÿæˆæ–°çš„é£Ÿç‰©
            if (gameData.foodItems.length < 5) {
                generateFood();
            }
            
            // ç¨å¾®åŠ å¿«æ¸¸æˆé€Ÿåº¦
            if (gameData.speed > 150) { // è®¾ç½®æœ€ä½é€Ÿåº¦é™åˆ¶
                gameData.speed -= config.speedIncrease;
                clearInterval(gameData.gameInterval);
                gameData.gameInterval = setInterval(gameLoop, gameData.speed);
            }
        }
        
        // ç”Ÿæˆé£Ÿç‰© - æ”¹è¿›ç‰ˆï¼Œç¡®ä¿è¯è¯­åˆ†æ•£
        function generateFood() {
            const currentCategory = wordCategories[gameData.level - 1];
            const correctWords = [...currentCategory.correct];
            const wrongWords = [...currentCategory.wrong];
            
            // éšæœºæ‰“ä¹±æ•°ç»„
            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            };
            
            // é€‰æ‹©6ä¸ªæ­£ç¡®è¯è¯­å’Œ4ä¸ªé”™è¯¯è¯è¯­
            const selectedCorrect = shuffleArray(correctWords).slice(0, 6);
            const selectedWrong = shuffleArray(wrongWords).slice(0, 4);
            
            // ç”Ÿæˆæ­£ç¡®é£Ÿç‰© - ç¡®ä¿è¯è¯­åˆ†æ•£
            selectedCorrect.forEach(word => {
                let x, y, attempts = 0;
                do {
                    x = Math.floor(Math.random() * gameData.gameWidth);
                    y = Math.floor(Math.random() * gameData.gameHeight);
                    attempts++;
                    
                    // å¦‚æœå°è¯•æ¬¡æ•°è¿‡å¤šï¼Œæ”¾å®½è·ç¦»é™åˆ¶
                    const minDist = attempts > 50 ? config.minDistance / 2 : config.minDistance;
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–é£Ÿç‰©ä¿æŒè¶³å¤Ÿè·ç¦»
                    let tooClose = false;
                    for (const food of gameData.foodItems) {
                        const dist = Math.sqrt(Math.pow(food.x - x, 2) + Math.pow(food.y - y, 2));
                        if (dist < minDist) {
                            tooClose = true;
                            break;
                        }
                    }
                    
                    if (attempts > 100) break; // é˜²æ­¢æ— é™å¾ªç¯
                } while (isPositionOccupied(x, y) && attempts <= 100);
                
                gameData.foodItems.push({
                    x,
                    y,
                    word,
                    isCorrect: true
                });
            });
            
            // ç”Ÿæˆé”™è¯¯é£Ÿç‰© - ç¡®ä¿è¯è¯­åˆ†æ•£
            selectedWrong.forEach(word => {
                let x, y, attempts = 0;
                do {
                    x = Math.floor(Math.random() * gameData.gameWidth);
                    y = Math.floor(Math.random() * gameData.gameHeight);
                    attempts++;
                    
                    // å¦‚æœå°è¯•æ¬¡æ•°è¿‡å¤šï¼Œæ”¾å®½è·ç¦»é™åˆ¶
                    const minDist = attempts > 50 ? config.minDistance / 2 : config.minDistance;
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–é£Ÿç‰©ä¿æŒè¶³å¤Ÿè·ç¦»
                    let tooClose = false;
                    for (const food of gameData.foodItems) {
                        const dist = Math.sqrt(Math.pow(food.x - x, 2) + Math.pow(food.y - y, 2));
                        if (dist < minDist) {
                            tooClose = true;
                            break;
                        }
                    }
                    
                    if (attempts > 100) break; // é˜²æ­¢æ— é™å¾ªç¯
                } while (isPositionOccupied(x, y) && attempts <= 100);
                
                gameData.foodItems.push({
                    x,
                    y,
                    word,
                    isCorrect: false
                });
            });
        }
        
        // æ£€æŸ¥ä½ç½®æ˜¯å¦è¢«å ç”¨
        function isPositionOccupied(x, y) {
            // æ£€æŸ¥è›‡çš„ä½ç½®
            for (const segment of gameData.snake) {
                if (segment.x === x && segment.y === y) {
                    return true;
                }
            }
            
            // æ£€æŸ¥é£Ÿç‰©çš„ä½ç½®
            for (const food of gameData.foodItems) {
                if (food.x === x && food.y === y) {
                    return true;
                }
            }
            
            return false;
        }
        
        // ç»˜åˆ¶è›‡
        function drawSnake() {
            gameData.snake.forEach((segment, index) => {
                const segmentElement = document.createElement('div');
                segmentElement.className = index === 0 ? 'snake-segment snake-head' : 'snake-segment snake-body';
                segmentElement.style.left = `${segment.x * gameData.gridSize}px`;
                segmentElement.style.top = `${segment.y * gameData.gridSize}px`;
                segmentElement.style.width = `${gameData.gridSize}px`;
                segmentElement.style.height = `${gameData.gridSize}px`;
                
                if (index === 0) {
                    segmentElement.textContent = 'ğŸ‘€';
                } else {
                    segmentElement.textContent = segment.word;
                }
                
                elements.gameArea.appendChild(segmentElement);
            });
        }
        
        // ç»˜åˆ¶é£Ÿç‰©
        function drawFood() {
            gameData.foodItems.forEach(food => {
                const foodElement = document.createElement('div');
                foodElement.className = 'food-item';
                foodElement.style.left = `${food.x * gameData.gridSize}px`;
                foodElement.style.top = `${food.y * gameData.gridSize}px`;
                foodElement.style.width = `${gameData.gridSize}px`;
                foodElement.style.height = `${gameData.gridSize}px`;
                foodElement.textContent = food.word;
                
                elements.gameArea.appendChild(foodElement);
            });
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            elements.scoreDisplay.textContent = gameData.score;
            elements.levelDisplay.textContent = `${gameData.level} (${wordCategories[gameData.level - 1].name})`;
            elements.targetDisplay.textContent = gameData.targetScore;
        }
        
        // å…³å¡å®Œæˆ
        function levelComplete() {
            clearInterval(gameData.gameInterval);
            gameData.isGameOver = true;
            gameData.canControl = false;
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            elements.bgMusic.pause();
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…³å¡éƒ½å®Œæˆäº†
            if (gameData.level >= wordCategories.length) {
                showWinModal(true);
            } else {
                showWinModal(false);
                elements.winSound.play();
            }
            
            // æ’’èŠ±æ•ˆæœ
            createConfetti();
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver() {
            clearInterval(gameData.gameInterval);
            gameData.isGameOver = true;
            gameData.canControl = false;
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            elements.bgMusic.pause();
            
            // æ˜¾ç¤ºå¤±è´¥åŸå› 
            elements.loseReason.textContent = gameData.lastLoseReason;
            
            showLoseModal();
        }
        
        // è¿›å…¥ä¸‹ä¸€å…³
        function nextLevel() {
            gameData.level++;
            gameData.score = 0;
            gameData.targetScore = 5;
            gameData.speed = config.initialSpeed;
            
            updateDisplay();
            startGame();
        }
        
        // æ˜¾ç¤ºå¼€å§‹æ¨¡æ€æ¡†
        function showStartModal() {
            hideAllModals();
            elements.startModal.style.display = 'flex';
        }
        
        // æ˜¾ç¤ºèƒœåˆ©æ¨¡æ€æ¡†
        function showWinModal(isFinalLevel) {
            hideAllModals();
            
            if (isFinalLevel) {
                document.querySelector('#win-modal h1').textContent = 'æ­å–œé€šå…³ï¼';
                document.querySelector('#win-modal p').textContent = 'ä½ æˆåŠŸå®Œæˆäº†æ‰€æœ‰å…³å¡ï¼';
                elements.nextLevelBtn.style.display = 'none';
            } else {
                document.querySelector('#win-modal h1').textContent = `æ­å–œå®Œæˆç¬¬${gameData.level}å…³ï¼`;
                document.querySelector('#win-modal p').textContent = `ä¸‹ä¸€å…³: ${wordCategories[gameData.level].name}`;
                elements.nextLevelBtn.style.display = 'block';
            }
            
            elements.winModal.style.display = 'flex';
        }
        
        // æ˜¾ç¤ºå¤±è´¥æ¨¡æ€æ¡†
        function showLoseModal() {
            hideAllModals();
            elements.loseModal.style.display = 'flex';
        }
        
        // éšè—æ‰€æœ‰æ¨¡æ€æ¡†
        function hideAllModals() {
            elements.startModal.style.display = 'none';
            elements.winModal.style.display = 'none';
            elements.loseModal.style.display = 'none';
        }
        
        // åˆ›å»ºæ’’èŠ±æ•ˆæœ
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = `${Math.random() * 2 + 1}s`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                elements.gameArea.appendChild(confetti);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        function handleDirectionChange(newDirection) {
            if (gameData.isGameOver || !gameData.canControl) return;
            
            // é˜²æ­¢180åº¦è½¬å¼¯
            if (
                (gameData.direction === 'up' && newDirection !== 'down') ||
                (gameData.direction === 'down' && newDirection !== 'up') ||
                (gameData.direction === 'left' && newDirection !== 'right') ||
                (gameData.direction === 'right' && newDirection !== 'left')
            ) {
                gameData.nextDirection = newDirection;
            }
        }
        
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp': handleDirectionChange('up'); break;
                case 'ArrowDown': handleDirectionChange('down'); break;
                case 'ArrowLeft': handleDirectionChange('left'); break;
                case 'ArrowRight': handleDirectionChange('right'); break;
                case ' ': gameData.isPaused = !gameData.isPaused; break;
            }
        });
        
        // ç§»åŠ¨ç«¯æ§åˆ¶
        elements.upBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleDirectionChange('up');
        });
        
        elements.downBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleDirectionChange('down');
        });
        
        elements.leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleDirectionChange('left');
        });
        
        elements.rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleDirectionChange('right');
        });
        
        // æŒ‰é’®äº‹ä»¶
        elements.startBtn.addEventListener('click', startGame);
        elements.nextLevelBtn.addEventListener('click', nextLevel);
        elements.restartBtn.addEventListener('click', startGame);
        elements.restartGameBtn.addEventListener('click', () => {
            gameData.level = 1;
            startGame();
        });
        
        // å¼€å§‹æ§åˆ¶æŒ‰é’®
        elements.startControlBtn.addEventListener('click', () => {
            if (!gameData.gameStarted) return;
            
            gameData.canControl = !gameData.canControl;
            
            if (gameData.canControl) {
                elements.startControlBtn.textContent = "æ§åˆ¶ä¸­...";
                elements.startControlBtn.disabled = true;
                
                // å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                if (gameData.musicOn) {
                    elements.bgMusic.currentTime = 0;
                    elements.bgMusic.play();
                }
            }
        });
        
        elements.musicBtn.addEventListener('click', () => {
            gameData.musicOn = !gameData.musicOn;
            if (gameData.musicOn) {
                if (gameData.canControl && !gameData.isGameOver) {
                    elements.bgMusic.play();
                }
                elements.musicBtn.textContent = 'å…³é—­éŸ³ä¹';
            } else {
                elements.bgMusic.pause();
                elements.musicBtn.textContent = 'å¼€å¯éŸ³ä¹';
            }
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—æ¸¸æˆåŒºåŸŸ
        window.addEventListener('resize', () => {
            if (gameData.gameStarted && !gameData.isGameOver) {
                calculateGameSize();
            }
        });
        
        // åˆå§‹åŒ–æ˜¾ç¤º
        showStartModal();
    </script>
</body>
</html>